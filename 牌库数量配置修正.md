# 牌库数量配置修正

## 修改概述

根据实际卡牌数据,修正了牌库数量的配置和计算逻辑。

## 实际卡牌构成

- **一套牌总数**: 233 张
  - 普通卡: 230 张 (ID: 1-66, 70-233)
  - 冬季卡: 3 张 (ID: 67-69)
- **最大牌库**: 230 × 3 + 3 = 693 张

## 修改内容

### 1. 常量配置 (`miniprogram/data/constants.js`)

```javascript
const GAME_CONFIG = {
  BASE_DECK_SIZE: 233, // 一套牌:230张普通卡 + 3张冬季卡
  WINTER_CARD_COUNT: 3, // 冬季卡数量
  MAX_DECK_SIZE: 693, // 最大牌库:230*3 + 3 = 693张
};
```

### 2. 默认值更新 (`miniprogram/pages/lobby/lobby.js`)

- 默认牌库数量从 236 改为 233
- 添加了最大值验证(693 张)
- 输入超过最大值时自动限制并提示

### 3. UI 提示更新 (`miniprogram/pages/lobby/lobby.wxml`)

- 标签提示: "含冬季卡,最多 693 张"
- 输入框占位符: "请输入卡牌总数 (1-693 张)"

### 4. 牌库构建逻辑修正 (`miniprogram/pages/lobby/lobby.js`)

**关键修复**:

- 正确计算每套牌的普通卡数量(230 张,排除冬季卡)
- 预先过滤出普通卡列表,避免重复过滤
- 确保多套牌时的数量计算准确

**修正前的问题**:

```javascript
// 错误: oneSetCount 包含了冬季卡,导致计算不准确
const oneSetCount = sourceKeys.length; // 233
```

**修正后**:

```javascript
// 正确: 只计算普通卡数量
const normalCards = sourceKeys.filter((key) => {
  const cardDef = sourceData[key];
  return cardDef && cardDef.type !== CARD_TYPES.W_CARD;
});
const oneSetCount = normalCards.length; // 230
```

## 验证示例

### 单套牌 (233 张)

- 用户输入: 233
- 普通卡: 230 张
- 冬季卡: 3 张
- 总计: 233 张 ✓

### 双套牌 (463 张)

- 用户输入: 463
- 普通卡: 460 张 (230 × 2)
- 冬季卡: 3 张
- 总计: 463 张 ✓

### 三套牌 (693 张,最大值)

- 用户输入: 693
- 普通卡: 690 张 (230 × 3)
- 冬季卡: 3 张
- 总计: 693 张 ✓

## 注意事项

1. 用户输入的牌库数量**包含冬季卡**
2. 系统会自动从总数中减去 3 张冬季卡,剩余部分用于构建普通卡牌库
3. 冬季卡始终是 3 张,会被洗入牌库底部指定范围内
